@model Proyecto_LibreriaRincondelQuijote.Models.Carrito

@{
    ViewBag.Title = "Carrito de Compras";

    // Calculamos el total solo una vez y lo almacenamos en una variable
    var total = Model.CarritosProductos
                    .Where(cp => cp.Producto != null)  // Filtra los productos no nulos
                    .Sum(cp => cp.Producto.Precio);   // Suma los precios de los productos
}

<h2>Carrito de Compras</h2>

@if (Model.CarritosProductos != null && Model.CarritosProductos.Any())
{
    <table class="table">
        <thead>
            <tr>
                <th>Producto</th>
                <th>Precio</th>
                <th>Cantidad</th>
                <th>Subtotal</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.CarritosProductos)
            {
                <tr>
                    <td>
                        @if (item.Producto != null)
                        {
                            @item.Producto.Nombre
                        }
                        else
                        {
                            <span>Producto no disponible</span>
                        }
                    </td>
                    <td>
                        @if (item.Producto != null)
                        {
                            @item.Producto.Precio.ToString("C")
                        }
                        else
                        {
                            <span>No disponible</span>
                        }
                    </td>
                    <td>1</td> <!-- Aquí puedes agregar la cantidad si deseas -->
                    <td>
                        @if (item.Producto != null)
                        {
                            @(item.Producto.Precio.ToString("C"))
                        }
                        else
                        {
                            <span>No disponible</span>
                        }
                    </td>
                    <td>
                        @Html.ActionLink("Eliminar", "EliminarDelCarrito", new { id = item.CodigoCarrito }, new { @class = "btn btn-danger" })
                    </td>

                </tr>
            }
        </tbody>
    </table>

    <div class="d-flex justify-content-end">
        <h4>
            Total:
            @total.ToString("C") <!-- Muestra el total formateado como moneda -->
        </h4>
    </div>

    <!-- Aquí puedes agregar un botón para proceder a la compra -->
    <div class="mt-3">
        <a href="@Url.Action("ProcederAlPago", "Carrito")" class="btn btn-primary">Proceder al Pago</a>
    </div>

}
else
{
    <p>No tienes productos en tu carrito.</p>
}
